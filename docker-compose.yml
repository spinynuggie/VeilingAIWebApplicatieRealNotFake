version: '3.8'

services:
  db:
    image: postgres:16-alpine
    container_name: veiling-db
    restart: always
    environment:
      POSTGRES_DB: VeilingWebsiteDB
      POSTGRES_USER: devuser
      POSTGRES_PASSWORD: Shrek
    volumes:
      - postgres_data:/var/lib/postgresql/data
    networks:
      - veiling-network

  app:
    # Cookie & Cross-Site handshake fix
    image: rayantjedo/veiling-backend:v5-cookie-fix
    container_name: veiling-app
    restart: always
    environment:
      - ASPNETCORE_ENVIRONMENT=Production
      - ConnectionStrings__DefaultConnection=Host=db;Database=VeilingWebsiteDB;Username=devuser;Password=Shrek
      - ASPNETCORE_URLS=http://+:8080
      - Jwt__Key=dev-secret-change-me-please-change-now!!
      - Jwt__Issuer=VeilingAI
      - Jwt__Audience=VeilingAIUsers
      - FRONTEND_URL=https://veiling-ai-web-applicatie-real-not.vercel.app
    depends_on:
      - db
    networks:
      - veiling-network
    volumes:
      - backend_uploads:/app/wwwroot/uploads

networks:
  veiling-network:
    driver: bridge

volumes:
  postgres_data:
  backend_uploads:
